import chalk from 'chalk';
import { readFile } from 'fs/promises';
import { installSkill } from '../config.js';
export async function importCommand(file) {
    console.log(chalk.blue(`ðŸ“¥ Importing from ${file}...`));
    let manifest;
    try {
        const content = await readFile(file, 'utf-8');
        manifest = JSON.parse(content);
    }
    catch (error) {
        console.error(chalk.red('âŒ Failed to read file:'), error instanceof Error ? error.message : error);
        process.exit(1);
    }
    console.log(chalk.green(`âœ“ Loaded ${manifest.skills.length} skill(s)`));
    console.log(chalk.gray(`  Platform: ${manifest.platform}`));
    console.log(chalk.gray(`  Exported: ${new Date(manifest.exportedAt).toLocaleString()}`));
    // Install skills
    console.log(chalk.blue('\nðŸ“¦ Installing skills...\n'));
    const installed = [];
    const failed = [];
    const skipped = [];
    for (const skill of manifest.skills) {
        const name = skill.name;
        process.stdout.write(chalk.gray(`  Installing ${name}... `));
        try {
            await installSkill(name, skill.source);
            console.log(chalk.green('âœ“'));
            installed.push(name);
        }
        catch (error) {
            if (error.message?.includes('already installed') || error.message?.includes('already exists')) {
                console.log(chalk.yellow('âš  already installed'));
                skipped.push(name);
            }
            else {
                console.log(chalk.red('âœ—'));
                console.error(chalk.gray(`    ${error.message}`));
                failed.push(name);
            }
        }
    }
    // Summary
    console.log(chalk.blue('\nðŸ“Š Summary:'));
    console.log(chalk.green(`  âœ“ Installed: ${installed.length}`));
    if (skipped.length > 0) {
        console.log(chalk.yellow(`  âš  Skipped: ${skipped.length}`));
    }
    if (failed.length > 0) {
        console.log(chalk.red(`  âœ— Failed: ${failed.length}`));
    }
    if (installed.length > 0) {
        console.log(chalk.yellow('\nðŸ’¡ Tip: Restart OpenClaw gateway to load new skills:'));
        console.log(chalk.cyan('  openclaw gateway restart'));
    }
}
