import chalk from 'chalk';
import { getConfig } from '../config.js';
import { exec } from 'child_process';
import { promisify } from 'util';
const execAsync = promisify(exec);
export async function statusCommand() {
    console.log(chalk.blue('ğŸ“Š clawpack çŠ¶æ€æ£€æŸ¥\n'));
    // GitHub Token Status
    console.log(chalk.cyan('ğŸ” GitHub æˆæƒçŠ¶æ€'));
    const config = await getConfig();
    let authSource = 'æœªé…ç½®';
    let authStatus = 'âŒ';
    if (process.env.GITHUB_TOKEN) {
        authSource = 'GITHUB_TOKEN ç¯å¢ƒå˜é‡';
        authStatus = 'âœ…';
    }
    else if (process.env.GH_TOKEN) {
        authSource = 'GH_TOKEN ç¯å¢ƒå˜é‡';
        authStatus = 'âœ…';
    }
    else if (config.githubToken) {
        // Check if it's from gh CLI
        try {
            const { stdout } = await execAsync('gh auth token', { timeout: 3000 });
            if (stdout.trim() === config.githubToken) {
                authSource = 'GitHub CLI (gh auth)';
            }
            else {
                authSource = 'é…ç½®æ–‡ä»¶ (~/.config/clawpack/config.json)';
            }
        }
        catch {
            authSource = 'é…ç½®æ–‡ä»¶ (~/.config/clawpack/config.json)';
        }
        authStatus = 'âœ…';
    }
    console.log(`   çŠ¶æ€: ${authStatus === 'âœ…' ? chalk.green('å·²æˆæƒ') : chalk.red('æœªæˆæƒ')}`);
    if (authStatus === 'âœ…') {
        console.log(`   æ¥æº: ${chalk.gray(authSource)}`);
        console.log(`   Token: ${chalk.gray(config.githubToken?.substring(0, 12) + '...')}`);
    }
    // Config Status
    console.log(chalk.cyan('\nâš™ï¸  é…ç½®çŠ¶æ€'));
    if (config.defaultGistId) {
        console.log(`   é»˜è®¤å¤‡ä»½: ${chalk.green(config.defaultGistId)}`);
        console.log(`   æŸ¥çœ‹å¤‡ä»½: ${chalk.gray(`https://gist.github.com/${config.defaultGistId}`)}`);
    }
    else {
        console.log(`   é»˜è®¤å¤‡ä»½: ${chalk.yellow('æœªè®¾ç½®')}`);
    }
    // Next Steps
    if (authStatus !== 'âœ…') {
        console.log(chalk.yellow('\nğŸ’¡ å¦‚ä½•æˆæƒï¼Ÿ'));
        console.log(chalk.gray('   æ–¹å¼ 1 (æ¨è):'));
        console.log(chalk.gray('     export GITHUB_TOKEN=ghp_your_token_here'));
        console.log(chalk.gray('   æ–¹å¼ 2:'));
        console.log(chalk.gray('     gh auth login'));
        console.log(chalk.gray('   åˆ›å»º Token: https://github.com/settings/tokens'));
    }
    else {
        console.log(chalk.green('\nâœ“ æˆæƒæ­£å¸¸ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½'));
    }
}
